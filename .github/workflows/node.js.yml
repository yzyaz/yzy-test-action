# ä¸€ä¸ªGitHub Actionsè„šæœ¬, å¯éƒ¨ç½²è‡³GitHub Pageså’Œè‡ªå·±æœåŠ¡å™¨
# ${{secrets.}} ç­‰å˜é‡éœ€è¦åœ¨setting>secrets>actionsä¸­é…ç½®
# å®˜ç½‘é…ç½®æ–‡æ¡£ https://docs.github.com/en/actions/using-workflows/workflow-syntax-for-github-actions
name: GitHub Actions Build and Deploy Demo

# å­—æ®µæŒ‡å®šè§¦å‘ workflow çš„æ¡ä»¶
on:
  # è§¦å‘çš„åˆ†æ”¯
  push:
    branches:
      - master

jobs:
  # ä¸€ä¸ªjobä»»åŠ¡ï¼Œä»»åŠ¡åä¸ºbuild-and-deploy
  build-and-deploy:
    # runs-on æŒ‡å®šjobä»»åŠ¡è¿è¡Œæ‰€éœ€è¦çš„è™šæ‹Ÿæœºç¯å¢ƒ(å¿…å¡«å­—æ®µ)
    runs-on: ubuntu-latest
    # stepsæ˜¯æ¯ä¸ªJobçš„è¿è¡Œæ­¥éª¤ï¼Œå¯ä»¥åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªæ­¥éª¤
    steps:
      # åˆ‡æ¢åˆ†æ”¯
      - name: Checkout
        # ä½¿ç”¨actionåº“
        uses: actions/checkout@v2.4.0

      # å®‰è£…ä¾èµ–å’Œæ‰“åŒ…
      - name: å®‰è£…ä¾èµ– æ‰“åŒ…
        run: |
          npm i
          npm run build

      # éƒ¨ç½²è‡³GitHub Pages
      # - name: deploy file to GitHub Pages
      #   uses: JamesIves/github-pages-deploy-action@v4.2.2
      #   with:
      #     token: ${{ secrets.ACCESS_TOKEN }}
      #     branch: gh-pages
      #     folder: build

      ## éƒ¨ç½²è‡³è‡ªå·±çš„æœåŠ¡å™¨
      # - name: deploy file to server
      #   uses: wlixcc/SFTP-Deploy-Action@v1.0
      #   with:
      #     username: 'root'
      #     server: '${{ secrets.SERVER_IP }}'
      #     ssh_private_key: ${{ secrets.SSH_PRIVATE_KEY }}
      #     local_path: './build/*'
      #     remote_path: '/dockerDir/nginx/project/yzy-test-action'

      # - name: å‰ç«¯æ–‡ä»¶å‹ç¼©ğŸ“¦
      #   run: |
      #     ls
      #     cd ./build
      #     sudo apt-get install unzip
      #     zip -r build.zip ./* -r
      #     ls

      - name: æ‹·è´æ–‡ä»¶(ä½¿ç”¨å¯†ç è¿æ¥)
        uses: appleboy/scp-action@master
        with:
          host: 106.52.76.36
          username: root
          password: yu1092517087.
          port: 22
          source: './build/*'
          target: '/dockerDir/nginx/project/yzy-test-action'
          rm: true
          strip_components: 1

      # - name: ssh-actionä½¿ç”¨å¯†ç 
      #   uses: appleboy/ssh-action@master
      #   with:
      #     host: 106.52.76.36
      #     username: root
      #     password: yu1092517087.
      #     #    port: ${{ secrets.PORT }}
      #     script: whoami
